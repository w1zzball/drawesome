{% extends 'base_generic.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/game.css' %}" />
  <link rel="stylesheet" href="{% static 'css/rooms.css' %}" />
{% endblock %}

{% block content %}
  <div class="container">
    <h1>Drawing Rooms</h1>

    <div class="room-actions">
      <a href="{% url 'rooms:create_room' %}" class="btn btn-primary">Create New Room</a>
    </div>

    <div class="room-list">
      <h2>Available Rooms</h2>
      {% if rooms %}
        <ul class="rooms">
          {% for room in rooms %}
            <li class="room-item">
              <div class="room-info">
                <h3><a href="{% url 'rooms:room' room_slug=room.slug %}">{{ room.name }}</a></h3>
                <p>Created by {{ room.creator.username }} on {{ room.created_at|date:'M d, Y' }}</p>
              </div>
              <div class="room-actions">
                <a href="{% url 'rooms:room' room_slug=room.slug %}" class="btn btn-sm btn-success">Join</a>
                <button class="btn btn-sm btn-info copy-link" data-url="{{ request.scheme }}://{{ request.get_host }}{% url 'rooms:room' room_slug=room.slug %}">Share Link</button>
                {% if room.creator == user %}
                  <form method="post" action="{% url 'rooms:delete_room' room_slug=room.slug %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                  </form>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No rooms available. Be the first to create one!</p>
      {% endif %}
    </div>
  </div>

  <script>
    // Helper to copy room URLs
    document.querySelectorAll('.copy-link').forEach((button) => {
      button.addEventListener('click', () => {
        const url = button.dataset.url
        navigator.clipboard.writeText(url).then(() => {
          button.textContent = 'Copied!'
          setTimeout(() => {
            button.textContent = 'Share Link'
          }, 2000)
        })
      })
    })
  </script>
{% endblock %}
