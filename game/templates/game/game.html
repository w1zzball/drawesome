{% extends 'base_generic.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/game.css' %}" />
{% endblock %}

{% block content %}
  <div class="container">
    <h1>
      {% if room %}
        {{ room.name }}
      {% else %}
        Public Drawing Room
      {% endif %}
    </h1>

    <!-- Room info and sharing -->
    <div class="room-info">
      {% if room %}
        <p>Room created by: {{ room.creator.username }}</p>
      {% endif %}
      <div class="share-link">
        <input type="text" id="room-url" value="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}" readonly />
        <button id="copy-link" class="btn btn-sm btn-info">Copy Link</button>
      </div>
    </div>

    <!-- User info section -->
    <div class="user-info">
      <span class="drawing-indicator" id="user-color-indicator"></span>
      <span id="client-id"></span>
    </div>

    <!-- Store room name for JavaScript -->
    <input type="hidden" id="room-name" value="{{ room_name }}" />

    <!-- Drawing Board -->
    <div id="game-container">
      <div id="game-area">
        <canvas id="drawing-board" width="600" height="600"></canvas>
      </div>
      <div id="game-sidebar" class="side-panel">
        <!-- Drawing Controls -->
        <div class="controls">
          <button id="clear-button">Clear Canvas</button>
          <input type="color" id="color-picker" value="#000000" />
          <input type="range" id="line-width" min="1" max="20" value="5" />
          <span id="line-width-value">5px</span>
        </div>
        <!-- Chat Interface -->
        <form id="chat-form" autocomplete="off">
          <input type="text" id="chat-message" placeholder="Type a message..." required minlength="1" />
          <button type="submit">Send</button>
        </form>
        <div id="chat-messages"></div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/canvas.js' %}"></script>
  <script>
    // Copy room URL to clipboard
    document.getElementById('copy-link').addEventListener('click', function () {
      const urlField = document.getElementById('room-url')
      urlField.select()
      navigator.clipboard.writeText(urlField.value).then(() => {
        this.textContent = 'Copied!'
        setTimeout(() => {
          this.textContent = 'Copy Link'
        }, 2000)
      })
    })
  </script>
{% endblock %}
